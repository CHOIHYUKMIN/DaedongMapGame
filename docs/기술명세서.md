# Anti-Gravity 엔진 기술 명세서
**프로젝트**: 대동맛지도 서울경기편

---

## 1. 개발 환경

### 1.1 엔진 및 언어
- **엔진**: Anti-Gravity (올인원 독립 실행형)
- **스크립트 언어**: C# / JavaScript
- **데이터 포맷**: CSV (엔진 내부 로드)
- **저장 방식**: Local Storage (암호화)

### 1.2 제약 사항
- ❌ 외부 서버 없음 (서버리스)
- ❌ 외부 DB 없음 (MySQL, MongoDB 등)
- ✅ 모든 기능을 엔진 내부에서 처리

---

## 2. 데이터 구조

### 2.1 CSV 파일 구조

#### LevelData.csv
| Column | Type | Description | Example |
|--------|------|-------------|---------|
| ID | int | 레벨 고유 ID | 1001 |
| RegionName | string | 지역명 | "태평로1가" |
| MissionType | enum | 승리 조건 | COLLECT, SCORE, BOSS |
| TargetVal | int | 목표 수치 | 10 |
| Moves | int | 이동 횟수 | 15 |
| Gimmick | string | 장애물 ID | "BOX,ICE" |
| RewardItem | string | 드롭 아이템 | "IT_001" |
| IsAdStage | bool | 맛집 스테이지 여부 | FALSE |

#### ItemData.csv
| Column | Type | Description | Example |
|--------|------|-------------|---------|
| ItemID | string | 아이템 코드 | "IT_005" |
| Name | string | 이름 | "수원 왕갈비" |
| EffectType | enum | 효과 종류 | STAT_UP, POINT |
| EffectVal | int | 효과 수치 | 10 |
| Desc | string | 설명 | "전설의 맛..." |

#### CharacterData.csv
| Column | Type | Description | Example |
|--------|------|-------------|---------|
| CharID | string | 캐릭터 ID | "CH_40M" |
| Name | string | 이름 | "아웃도어 형님" |
| Passive | string | 고유 능력 | "STAMINA_REGEN" |
| Resource | string | 스프라이트 경로 | "Char_40M.png" |

---

## 3. 클래스 아키텍처

### 3.1 GameManager (싱글톤)
**역할**: 게임 전체 상태 관리

```csharp
class GameManager {
    // 데이터
    UserData currentUser;
    List<LevelData> levels;
    List<ItemData> items;
    
    // 함수
    void Initialize();          // CSV 로드
    void GameStart(int levelID); // 레벨 시작
}
```

### 3.2 MapSystem
**역할**: 지도 렌더링 및 네비게이션

```csharp
class MapSystem {
    void RenderZone(int zoneID);      // 현재 Zone만 렌더링
    void UnlockRegion(int regionID);  // 클리어 효과
}
```

### 3.3 PuzzleController
**역할**: 3-Match 퍼즐 로직

```csharp
class PuzzleController {
    Block[,] grid = new Block[9,9];
    
    void SwapAndCheck(int x1, int y1, int x2, int y2);
    bool CheckMatch();
    void ApplyGravity();
    void OnStageClear(bool isAdStage);
}
```

### 3.4 SaveSystem
**역할**: 로컬 데이터 암호화 저장

```csharp
class SaveSystem {
    string key = "AntiGravitySecret";
    
    void Save(UserData data);    // AES 암호화 저장
    UserData Load();             // 복호화 후 로드
}
```

---

## 4. 씬(Scene) 구성

### Scene 1: Title_Lobby
**구성 요소**:
- Panel_Intro: 로고 + 터치투스타트
- Panel_CharSelect: 10종 캐릭터 선택 UI
- Button_Start: 메인 맵으로 이동

### Scene 2: Main_Map
**구성 요소**:
- ScrollRect: 서울/경기 지도 이미지
- NodeContainer: 스테이지 노드 동적 생성
- Top_Bar: 골드, MP, 하트 표시
- Bottom_Menu: 지도, 가방, 상점, 설정

### Scene 3: InGame_Puzzle
**구성 요소**:
- Grid_Board: 7x7 ~ 9x9 퍼즐판
- Block_Prefab: 5종 일반 + 특수 블록
- Top_HUD: 이동 횟수, 미션, 점수
- Bottom_Skill: 스킬 버튼, 아이템
- Popup_Result: 클리어 결과 + 보상

---

## 5. 핵심 알고리즘

### 5.1 3-Match 검사
```csharp
bool CheckMatch(int x, int y) {
    Block current = Grid[x][y];
    
    // 가로 체크
    if (Grid[x-1][y] == current && Grid[x+1][y] == current)
        return true;
    
    // 세로 체크
    if (Grid[x][y-1] == current && Grid[x][y+1] == current)
        return true;
    
    return false;
}
```

### 5.2 중력 적용
```csharp
void ApplyGravity() {
    for (int x = 0; x < Width; x++) {
        for (int y = Height - 1; y >= 0; y--) {
            if (Grid[x][y] == null) {
                PullBlockDown(x, y);
            }
        }
    }
    FillTopRow(); // 빈 공간에 새 블록 생성
}
```

### 5.3 쿠폰 생성
```csharp
string GenerateCoupon(string region) {
    string date = DateTime.Now.ToString("yyyyMMdd");
    string randomHex = Random.Range(0, 0xFFFF).ToString("X4");
    
    return $"{region}-{date}-{randomHex}";
    // 예: "SUWON-20251218-A1F9"
}
```

---

## 6. 최적화 전략

### 6.1 메모리 관리
- **오브젝트 풀링**: 블록 재사용
- **동적 로딩**: 현재 Zone만 렌더링
- **스프라이트 아틀라스**: 텍스처 메모리 절약

### 6.2 데이터 로딩
- 게임 시작 시 전체 CSV를 메모리에 로드
- Zone 전환 시 필요한 데이터만 활성화

---

## 7. 보안

### 7.1 세이브 데이터 암호화
```csharp
string Encrypt(string plainText, string key) {
    // AES-256 암호화
    // XOR 추가 변조
    return encryptedText;
}
```

### 7.2 포인트 조작 방지
- MP 값을 암호화하여 저장
- 게임 내에서만 복호화
- 파일 직접 수정 불가능하게 처리

---

## 8. 파일 구조

```
AntiGravityProject/
├── Assets/
│   ├── Data/
│   │   ├── LevelData.csv
│   │   ├── ItemData.csv
│   │   └── CharacterData.csv
│   ├── Sprites/
│   │   ├── Blocks/
│   │   ├── Characters/
│   │   └── Maps/
│   └── Scripts/
│       ├── GameManager.cs
│       ├── PuzzleController.cs
│       ├── MapSystem.cs
│       └── SaveSystem.cs
└── Scenes/
    ├── Title_Lobby.scene
    ├── Main_Map.scene
    └── InGame_Puzzle.scene
```

---

**문서 버전**: v1.0  
**최종 수정일**: 2025-12-18
