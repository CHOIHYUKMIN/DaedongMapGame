<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>말랑말랑 대동맛지도</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <link rel="stylesheet" href="css/style.css?v=1.3.0">
    <link rel="stylesheet" href="css/mobile.css?v=1.3.0">
    <link rel="stylesheet" href="css/blocks.css?v=1.3.0">
    <link rel="stylesheet" href="css/ui-enhancements.css?v=1.3.0">
    <link rel="stylesheet" href="css/animations.css?v=1.3.0">
    <link rel="stylesheet" href="css/costume.css?v=1.3.0">
    <link rel="stylesheet" href="css/puzzle-layout.css?v=1.3.0">
    <link rel="stylesheet" href="css/restaurant-collection.css?v=1.3.0">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7456046576951897"
        crossorigin="anonymous"></script>
</head>

<body>
    <!-- 메인 컨테이너 -->
    <div id="game-container">

        <!-- 메인 메뉴 화면 -->
        <div id="main-menu" class="screen active">
            <!-- 로그인 상태 표시 -->
            <div class="login-status" style="position: absolute; top: 10px; right: 10px; z-index: 100;">
                <button id="login-btn" class="btn" onclick="FirebaseAuth.loginWithGoogle()"
                    style="font-size: 14px; padding: 8px 16px;">
                    🔐 Google 로그인
                </button>
                <div id="user-info"
                    style="display: none; align-items: center; gap: 10px; 
                     background: white; padding: 8px 12px; border-radius: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <!-- 로그인 후 사용자 정보 표시 -->
                </div>
            </div>

            <div class="title">
                <h1>말랑말랑<br>대동맛지도</h1>
                <p class="subtitle">서울경기도</p>
            </div>
            <div class="map-selection-container">
                <h3>지역을 선택하세요</h3>
                <div id="region-map"></div>
                <p style="text-align: center; color: #999; font-size: 12px; margin-top: 10px;">
                    지도에서 서울을 클릭하세요
                </p>
            </div>
            <div class="menu-buttons">
                <button class="btn-large" id="collection-btn">📖 맛집 도감</button>
                <button class="btn-large" onclick="Game.showInfo()">게임 정보</button>
                <button class="btn-large" onclick="Game.showSettings()">설정</button>
            </div>
            <div class="version">v0.1 프로토타입</div>
        </div>

        <!-- 맛집 도감 화면 -->
        <div id="collection-screen" class="screen">
            <div class="collection-header">
                <h2>📖 맛집 도감</h2>
                <button id="collection-close-btn" class="close-btn">✕</button>
            </div>

            <!-- 통계 요약 -->
            <div id="collection-stats" class="collection-stats">
                <!-- Stats will be populated by JS -->
            </div>

            <!-- 필터 및 정렬 -->
            <div class="collection-filters">
                <div class="filter-group">
                    <label>방문 상태:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="visited-filter" value="all" checked> 전체</label>
                        <label><input type="radio" name="visited-filter" value="visited"> 방문함</label>
                        <label><input type="radio" name="visited-filter" value="not-visited"> 미방문</label>
                    </div>
                </div>
                <div class="filter-group">
                    <label>최소 별점:</label>
                    <select id="rating-filter">
                        <option value="all">전체</option>
                        <option value="5">⭐⭐⭐⭐⭐</option>
                        <option value="4">⭐⭐⭐⭐ 이상</option>
                        <option value="3">⭐⭐⭐ 이상</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>등급:</label>
                    <select id="rarity-filter">
                        <option value="all">전체</option>
                        <option value="S">S등급</option>
                        <option value="A">A등급</option>
                        <option value="B">B등급</option>
                        <option value="C">C등급</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label><input type="checkbox" id="favorite-filter"> 즐겨찾기만</label>
                </div>
                <div class="filter-group">
                    <label>정렬:</label>
                    <select id="sort-select">
                        <option value="dateAdded">최근 추가순</option>
                        <option value="rating">별점 높은순</option>
                        <option value="visitCount">재방문 많은순</option>
                        <option value="name">이름순</option>
                        <option value="lastVisit">최근 방문순</option>
                    </select>
                </div>
            </div>

            <!-- 맛집 목록 -->
            <div id="collection-list" class="collection-list">
                <!-- Restaurant cards will be populated by JS -->
            </div>
        </div>

        <!-- 맛집 상세 정보 팝업 (Enhanced) -->
        <div id="restaurant-detail-popup" class="popup">
            <div class="popup-content restaurant-detail-content">
                <button class="close-btn" onclick="RestaurantDetail.hide()">✕</button>
                <div class="detail-header">
                    <span id="detail-rarity-badge" class="rarity-badge">S</span>
                    <h2 id="detail-name">맛집 이름</h2>
                </div>
                <h3 id="detail-restaurant" class="restaurant-name">식당명</h3>

                <div class="detail-body">
                    <div class="info-section">
                        <div class="info-row" id="detail-address-row">
                            <i class="fas fa-map-marker-alt"></i>
                            <span id="detail-address"></span>
                        </div>
                        <div class="info-row" id="detail-phone-row">
                            <i class="fas fa-phone"></i>
                            <span id="detail-phone"></span>
                        </div>
                        <div class="info-row" id="detail-category-row">
                            <i class="fas fa-utensils"></i>
                            <span id="detail-category"></span>
                        </div>
                    </div>

                    <div class="description-section" id="detail-description-section">
                        <p id="detail-description"></p>
                    </div>

                    <div class="external-links" id="detail-links">
                        <!-- External links will be added by JS -->
                    </div>

                    <!-- Collection Info (if in collection) -->
                    <div class="collection-info" id="detail-collection-info" style="display: none;">
                        <h4>내 기록</h4>
                        <div class="my-rating">
                            <label>내 별점:</label>
                            <div class="star-rating-large" id="detail-star-rating">
                                <!-- Stars will be added by JS -->
                            </div>
                        </div>
                        <div class="my-visits">
                            <label class="visit-checkbox">
                                <input type="checkbox" id="detail-visited-checkbox">
                                <span>방문함 (<span id="detail-visit-count">0</span>회)</span>
                            </label>
                            <button class="btn-small" id="detail-add-visit-btn">+1 방문 추가</button>
                        </div>
                        <div class="my-notes">
                            <label>메모:</label>
                            <textarea id="detail-notes" placeholder="이 맛집에 대한 메모를 작성하세요..." rows="3"></textarea>
                            <button class="btn-small" id="detail-save-notes-btn">메모 저장</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 캐릭터 선택 화면 -->
        <div id="character-select" class="screen">
            <h2>연령대 선택</h2>
            <p class="subtitle">자신의 연령대를 선택하세요</p>

            <div class="age-selector">
                <button class="age-btn" data-age="10">10대</button>
                <button class="age-btn" data-age="20">20대</button>
                <button class="age-btn" data-age="30">30대</button>
                <button class="age-btn" data-age="40">40~50대</button>
                <button class="age-btn" data-age="60">60대+</button>
            </div>

            <div class="gender-selector">
                <button class="gender-btn" data-gender="M">남성</button>
                <button class="gender-btn" data-gender="F">여성</button>
            </div>

            <div id="selected-character" class="character-preview">
                <p>캐릭터를 선택해주세요</p>
            </div>

            <div class="button-row">
                <button class="btn" onclick="Game.showMainMenu()">돌아가기</button>
                <button class="btn btn-primary" onclick="Game.startGame()">시작하기</button>
            </div>
        </div>

        <!-- 지도 화면 -->
        <div id="map-screen" class="screen">
            <div class="top-bar">
                <div class="resource-display">
                    <span class="resource">💰 <span id="gold-display">0</span></span>
                    <span class="resource">⚡ <span id="mp-display">0</span></span>
                    <span class="resource">❤️ <span id="heart-display">5</span></span>
                </div>
            </div>

            <div class="map-container">
                <div id="seoul-map" style="width: 100%; height: 100%;"></div>
            </div>

            <div class="bottom-bar">
                <button class="icon-btn" onclick="Game.showMap()">🗺️ 지도</button>
                <button class="icon-btn" onclick="Game.showInventory()">🎒 가방</button>
                <button class="icon-btn" onclick="Game.showShop()">🏪 상점</button>
                <button class="icon-btn" onclick="Game.showSettings()">⚙️ 설정</button>
            </div>
        </div>

        <!-- 퍼즐 게임 화면 -->
        <div id="puzzle-screen" class="screen">
            <div class="puzzle-top-bar">
                <div id="level-info">레벨 1</div>
                <div id="mission-info">목표: <span id="target-score">1000</span>점</div>
                <div id="score-info">점수: <span id="current-score">0</span>점</div>
                <div id="moves-info">이동: <span id="moves-left">15</span></div>
            </div>

            <div id="puzzle-board"></div>

            <div class="puzzle-bottom-bar">
                <button class="booster-btn" id="hammer-btn" onclick="Puzzle.activateBooster('HAMMER')">
                    🔨 <span id="hammer-count">0</span>
                </button>
                <button class="booster-btn" id="bomb-btn" onclick="Puzzle.activateBooster('BOMB')">
                    💣 <span id="bomb-count">0</span>
                </button>
                <button class="booster-btn" id="rainbow-btn" onclick="Puzzle.activateBooster('RAINBOW')">
                    🌈 <span id="rainbow-count">0</span>
                </button>
                <button class="pause-btn" onclick="Game.pauseGame()">⏸️</button>
            </div>
        </div>

        <!-- 결과 팝업 -->
        <div id="result-popup" class="popup">
            <div class="popup-content">
                <h2 id="result-title">레벨 클리어</h2>
                <div id="result-stars">⭐⭐⭐</div>
                <p id="result-score">점수: 5000</p>
                <div id="result-rewards">
                    <p>보상:</p>
                    <ul id="reward-list"></ul>
                </div>
                <p id="next-level-msg" style="margin-top: 20px; color: #999; font-size: 14px;">
                    3초 후 다음 레벨로 이동합니다..
                </p>
                <div class="button-row">
                    <button class="btn" onclick="Game.showMap()">지도로</button>
                    <button class="btn btn-primary" onclick="Game.retryLevel()">재도전</button>
                </div>
            </div>
        </div>

        <!-- 인벤토리 팝업 -->
        <div id="inventory-popup" class="popup">
            <div class="popup-content inventory-content">
                <h2>내 인벤토리</h2>

                <!-- 캐릭터 정보 -->
                <div class="character-info">
                    <div class="character-avatar" id="inventory-avatar">👤</div>
                    <div class="character-details">
                        <h3 id="inventory-char-name">캐릭터 이름</h3>
                        <p id="inventory-char-desc">캐릭터 설명</p>
                        <div class="character-skill">
                            <span>🔥</span>
                            <span id="inventory-char-skill">스킬</span>
                        </div>
                    </div>
                </div>

                <!-- 아이템 목록 -->
                <div class="inventory-items">
                    <h3>보유 아이템</h3>
                    <div id="inventory-grid" class="item-grid">
                        <!-- 아이템들이 여기 표시됩니다 -->
                    </div>
                </div>

                <!-- 버튼 -->
                <div class="button-row">
                    <button class="btn" onclick="Game.closeInventory()">닫기</button>
                    <button class="btn" onclick="CostumeUI.open()">내 캐릭터 꾸미기</button>
                    <button class="btn btn-primary" onclick="Game.showCrafting()">조합하기</button>
                </div>
            </div>
        </div>

        <!-- 조합 팝업 -->
        <div id="crafting-popup" class="popup">
            <div class="popup-content crafting-content">
                <h2>새 아이템 조합</h2>

                <!-- 레시피 목록 -->
                <div class="recipe-list">
                    <h3>조합법</h3>
                    <div id="recipe-grid"></div>
                </div>

                <!-- 선택한 레시피 정보 -->
                <div id="selected-recipe" class="selected-recipe">
                    <p style="text-align: center; color: #999;">레시피를 선택하세요</p>
                </div>

                <!-- 버튼 -->
                <div class="button-row">
                    <button class="btn" onclick="Game.closeCrafting()">닫기</button>
                    <button class="btn btn-primary" id="craft-btn" onclick="Game.executeCraft()" disabled>조합하기</button>
                </div>
            </div>
        </div>

        <!-- 코스튬 커스터마이제이션 화면 -->
        <div id="costume-screen" class="screen">
            <h2>내 캐릭터 꾸미기</h2>

            <!-- 캐릭터 프리뷰 -->
            <div class="costume-preview-container">
                <canvas id="costume-preview-canvas" width="512" height="512"></canvas>
            </div>

            <!-- 스탯 보너스 요약 -->
            <div class="stat-bonus-summary">
                <h3>내 현재 코스튬 보너스</h3>
                <div class="stat-bonus-list" id="stat-bonus-list">
                    <!-- 보너스 스탯들이 여기 표시됩니다 -->
                </div>
            </div>

            <!-- 카테고리 탭 -->
            <div class="costume-category-tabs">
                <button class="costume-tab active" data-category="heads" onclick="CostumeUI.showCategory('heads')">👒
                    모자</button>
                <button class="costume-tab" data-category="tops" onclick="CostumeUI.showCategory('tops')">👕 상의</button>
                <button class="costume-tab" data-category="bottoms" onclick="CostumeUI.showCategory('bottoms')">👖
                    하의</button>
                <button class="costume-tab" data-category="bags" onclick="CostumeUI.showCategory('bags')">🎒 가방</button>
                <button class="costume-tab" data-category="accessories"
                    onclick="CostumeUI.showCategory('accessories')">📿 액세서리</button>
                <button class="costume-tab" data-category="special" onclick="CostumeUI.showCategory('special')">✨
                    특수</button>
            </div>

            <!-- 코스튬 그리드 -->
            <div id="costume-grid" class="costume-grid">
                <!-- 코스튬 아이템들이 여기 표시됩니다 -->
            </div>

            <!-- 버튼 -->
            <div class="button-row">
                <button class="btn" onclick="Game.showInventory()">돌아가기</button>
                <button class="btn btn-primary" onclick="CostumeUI.saveAndClose()">저장</button>
            </div>
        </div>

        <!-- 코스튬 상세 모달 -->
        <div id="costume-detail-modal" class="costume-detail-modal">
            <div class="costume-detail-content">
                <div class="costume-detail-icon" id="detail-icon">
                    <!-- 코스튬 아이콘 -->
                </div>
                <h3 class="costume-detail-name" id="detail-name">코스튬 이름</h3>
                <p class="costume-detail-description" id="detail-description">코스튬 설명</p>

                <div class="costume-detail-stats" id="detail-stats">
                    <!-- 스탯 정보 -->
                </div>

                <div class="costume-unlock-info" id="detail-unlock" style="display: none;">
                    <!-- 잠금 해제 조건 -->
                </div>

                <div class="button-row">
                    <button class="btn" onclick="CostumeUI.closeDetail()">닫기</button>
                    <button class="btn btn-primary" id="detail-equip-btn"
                        onclick="CostumeUI.equipFromDetail()">착용</button>
                </div>
            </div>
        </div>

    </div>

    <!-- JavaScript -->
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Version Info -->
    <script src="version.js?v=1.3.0"></script>

    <!-- Firebase Configuration -->
    <script src="js/firebase-config.js?v=1.3.0"></script>

    <script src="js/region-data.js?v=1.3.0"></script>
    <script src="js/data.js?v=1.3.0"></script>
    <script src="js/region.js?v=1.3.0"></script>
    <script src="js/restaurant.js?v=1.3.0"></script>
    <script src="js/restaurant-detail.js?v=1.3.0"></script>
    <script src="js/restaurant-collection.js?v=1.3.0"></script>
    <script src="js/puzzle.js?v=1.3.0"></script>
    <script src="js/costume.js?v=1.3.0"></script>
    <script src="js/costume-ui.js?v=1.3.0"></script>
    <script src="js/game.js?v=1.3.0"></script>
</body>

</html>